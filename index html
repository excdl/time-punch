<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LINE LIFF 打卡</title>
</head>
<body>
  <button onclick="checkIn()">打卡</button>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    async function checkIn() {
      await liff.init({ liffId: "2008493252-eAMXGMPd" });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      // 取得使用者資訊
      const profile = await liff.getProfile();

      // 取得使用者 IP
      const ipRes = await fetch('https://api.ipify.org?format=json');
      const ipData = await ipRes.json();

      const data = {
        userId: profile.userId,
        displayName: profile.displayName,
        ip: ipData.ip
      };

      // POST 到 Google Apps Script Web App
      const response = await fetch("https://script.google.com/macros/s/AKfycbyuJq4VNtzwPjoAEmrKdVz0xHc2QclqQDL052YGm7RzMLTH4v3MTTWCoPxy5a8J-2ib/exec", {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      });

      const result = await response.json();
      if (result.status === "success") {
        alert("打卡成功！");
      } else {
        alert("打卡失敗：" + result.message);
      }
    }
  </script>
</body>
</html>
